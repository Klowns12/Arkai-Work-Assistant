import { Injectable } from '@nestjs/common';
import { StorageService, StorageQuotaService } from '../storage';

@Injectable()
export class CommandService {
  constructor(
    private readonly storageService: StorageService,
    private readonly storageQuotaService: StorageQuotaService,
  ) {}

  handle(text: string, context?: { sourceType: 'user' | 'group'; userId?: string; groupId?: string }): string {
    const normalizedText = text.trim();
    const orgId = context?.groupId || context?.userId || 'personal';

    // Only support / prefix
    if (!normalizedText.startsWith('/')) {
      return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: /[‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á] ‡πÄ‡∏ä‡πà‡∏ô /‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠ /help';
    }
    const commandText = normalizedText.substring(1).trim();

    const [command, ...args] = commandText.split(' ');
    const argsText = args.join(' ');

    // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 1: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå
    if (command === '‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ' || command === '‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå') {
      return this.storeFile();
    }
    if (command === '‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå') {
      return this.findFile(argsText);
    }
    if (command === '‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î' || command === 'files') {
      return this.openRecentFile();
    }

    // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 2: ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢
    if (command === '‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ' || command === 'sum' || command === 'today') {
      return this.summarizeToday();
    }
    if (command === '‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô') {
      return this.summarizeYesterday();
    }
    if (command === '‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á') {
      return this.summarizeTopic(argsText);
    }
    if (command === '‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á') {
      return this.summarizeUserWork(argsText);
    }

    // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 3: ‡∏á‡∏≤‡∏ô / Task
    if (command === '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô') {
      return this.createTask('');
    }
    if (command === '‡∏á‡∏≤‡∏ô:') {
      return this.createTask(argsText);
    }
    if (command.startsWith('‡∏á‡∏≤‡∏ô:')) {
      return this.createTask(command.substring(4).trim() + ' ' + argsText);
    }
    if (command === '‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢') {
      return this.assignTask(argsText);
    }
    if (command === '‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô' || command === 'tasks') {
      return this.myTasks();
    }
    if (command === '‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î') {
      return this.allTasks();
    }

    // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 4: ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
    if (command === '‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ') {
      return this.setReminderTomorrow(argsText);
    }
    if (command === '‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô') {
      return this.setReminderDaily(argsText);
    }

    // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 5: Memory / ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó
    if (command === '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡πà‡∏≤') {
      return this.saveMemory(argsText);
    }
    if (command === '‡πÄ‡∏£‡∏≤‡∏ï‡∏Å‡∏•‡∏á‡∏≠‡∏∞‡πÑ‡∏£') {
      return this.recallAgreement(argsText);
    }
    if (command === '‡πÉ‡∏Ñ‡∏£‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö') {
      return this.recallResponsibility(argsText);
    }

    // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 6: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ & ‡∏£‡∏∞‡∏ö‡∏ö
    if (command === '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à') {
      return this.packageStatus();
    }
    if (command === '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£' || command === 'storage') {
      return this.storageStatus(orgId);
    }
    if (command === '‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ' || command === 'help') {
      return this.help();
    }

    return '‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á ‡∏û‡∏¥‡∏°‡∏û‡πå /help ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á';
  }

  // File upload handler for image/file messages
  async handleFileUpload(
    fileBuffer: Buffer,
    filename: string,
    contentType: string,
    context: { sourceType: 'user' | 'group'; userId?: string; groupId?: string },
  ): Promise<string> {
    const orgId = context.groupId || context.userId || 'personal';

    try {
      // Check quota before upload
      await this.storageQuotaService.checkQuota(orgId, fileBuffer.length);

      // Generate key and upload
      const key = this.storageService.generateKey(orgId, filename);
      const url = await this.storageService.uploadFile(key, fileBuffer, contentType);

      // Track storage usage
      await this.storageQuotaService.trackUpload(orgId, fileBuffer.length);

      return `üìÅ ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n‡∏ä‡∏∑‡πà‡∏≠: ${filename}\n‡∏Ç‡∏ô‡∏≤‡∏î: ${(fileBuffer.length / 1024).toFixed(1)} KB\n‡∏•‡∏¥‡∏á‡∏Å‡πå: ${url}`;
    } catch (error) {
      if (error.message?.includes('quota')) {
        return '‚ùå ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ï‡πá‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô';
      }
      if (error.message?.includes('File too large')) {
        return '‚ùå ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 20MB)';
      }
      return `‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`;
    }
  }

  // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 1: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå
  private storeFile(): string {
    return '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)';
  }

  private findFile(query: string): string {
    if (!query) {
      return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô: /‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå report.pdf';
    }
    return `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå "${query}"... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)`;
  }

  private openRecentFile(): string {
    return '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)';
  }

  // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 2: ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢
  private summarizeToday(): string {
    return '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)';
  }

  private summarizeYesterday(): string {
    return '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)';
  }

  private summarizeTopic(topic: string): string {
    if (!topic) {
      return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ ‡πÄ‡∏ä‡πà‡∏ô: /‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤';
    }
    return `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á "${topic}"... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)`;
  }

  private summarizeUserWork(mention: string): string {
    if (!mention) {
      return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÄ‡∏ä‡πà‡∏ô: /‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á @username';
    }
    return `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á ${mention}... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)`;
  }

  // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 3: ‡∏á‡∏≤‡∏ô / Task
  private createTask(taskText: string): string {
    if (!taskText) {
      return '‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô:\n1. ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô: ___\n2. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ___\n3. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á: ___\n\n‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡πá‡∏ß: /‡∏á‡∏≤‡∏ô: ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ';
    }
    return `‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô: "${taskText}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)`;
  }

  private assignTask(args: string): string {
    const parts = args.split(' ');
    if (parts.length < 2) {
      return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: /‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢ @‡∏ä‡∏∑‡πà‡∏≠ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô ‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤';
    }
    const user = parts[0];
    const remaining = parts.slice(1).join(' ');
    return `‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ ${user}: "${remaining}" (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)`;
  }

  private myTasks(): string {
    return '‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:\n‚Ä¢ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥ (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)';
  }

  private allTasks(): string {
    return '‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°:\n‚Ä¢ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)';
  }

  // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 4: ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
  private setReminderTomorrow(args: string): string {
    if (!args) {
      return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡πÄ‡∏ä‡πà‡∏ô: /‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ 10 ‡πÇ‡∏°‡∏á ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤';
    }
    return `‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ: ${args} (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)`;
  }

  private setReminderDaily(args: string): string {
    if (!args) {
      return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡πÄ‡∏ä‡πà‡∏ô: /‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô 9 ‡πÇ‡∏°‡∏á ‡∏™‡πÅ‡∏ï‡∏ô‡∏î‡πå‡∏≠‡∏±‡∏û';
    }
    return `‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô: ${args} (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)`;
  }

  // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 5: Memory / ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó
  private saveMemory(text: string): string {
    if (!text) {
      return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡πÄ‡∏ä‡πà‡∏ô: /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡πà‡∏≤ ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô';
    }
    return `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: "${text}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)`;
  }

  private recallAgreement(topic: string): string {
    return '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)';
  }

  private recallResponsibility(project: string): string {
    if (!project) {
      return '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ ‡πÄ‡∏ä‡πà‡∏ô: /‡πÉ‡∏Ñ‡∏£‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ';
    }
    return `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö "${project}"... (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)`;
  }

  // ‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà 6: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ & ‡∏£‡∏∞‡∏ö‡∏ö
  private packageStatus(): string {
    return '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à: ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)';
  }

  private storageStatus(orgId: string): string {
    const status = this.storageQuotaService.getStorageStatus(orgId);
    return `üìä ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö\n‡πÉ‡∏ä‡πâ‡πÑ‡∏õ: ${status.used}\n‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤: ${status.quota}\n‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${100 - status.percentage}% (${status.fileCount} ‡πÑ‡∏ü‡∏•‡πå)`;
  }

  private help(): string {
    return `üìö ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ:

üìÅ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå
‚Ä¢ /‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ
‚Ä¢ /‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå [‡∏ä‡∏∑‡πà‡∏≠]
‚Ä¢ /‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (/files)

üìù ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢
‚Ä¢ /‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (/sum, /today)
‚Ä¢ /‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô
‚Ä¢ /‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á [‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠]
‚Ä¢ /‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á @‡∏ä‡∏∑‡πà‡∏≠

‚úÖ ‡∏á‡∏≤‡∏ô / Task
‚Ä¢ /‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô
‚Ä¢ /‡∏á‡∏≤‡∏ô: [‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î]
‚Ä¢ /‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢ @‡∏ä‡∏∑‡πà‡∏≠ [‡∏á‡∏≤‡∏ô] [‡πÄ‡∏ß‡∏•‡∏≤]
‚Ä¢ /‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô (/tasks)
‚Ä¢ /‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

‚è∞ ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥
‚Ä¢ /‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ [‡πÄ‡∏ß‡∏•‡∏≤] [‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á]
‚Ä¢ /‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô [‡πÄ‡∏ß‡∏•‡∏≤] [‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á]

üß† Memory / ‡∏ö‡∏£‡∏¥‡∏ö‡∏ó
‚Ä¢ /‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡πà‡∏≤ [‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°]
‚Ä¢ /‡πÄ‡∏£‡∏≤‡∏ï‡∏Å‡∏•‡∏á‡∏≠‡∏∞‡πÑ‡∏£
‚Ä¢ /‡πÉ‡∏Ñ‡∏£‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ

üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ & ‡∏£‡∏∞‡∏ö‡∏ö
‚Ä¢ /‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à
‚Ä¢ /‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£
‚Ä¢ /help`;
  }
}